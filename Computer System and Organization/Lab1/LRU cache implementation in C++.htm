<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0036)http://timday.bitbucket.org/lru.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VwMGVVZSGwIIUFBQDwU="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o?o:e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({QJf3ax:[function(t,e){function n(t){function e(e,n,o){t&&t(e,n,o),o||(o={});for(var a=i(e),s=a.length,c=o[r]||(o[r]={}),f=0;s>f;f++)a[f].apply(c,n);return c}function o(t,e){s[t]=i(t).concat(e)}function i(t){return s[t]||[]}function a(){return n(e)}var s={};return{on:o,emit:e,create:a,listeners:i,_events:s}}var r="nr@context";e.exports=n()},{}],ee:[function(t,e){e.exports=t("QJf3ax")},{}],3:[function(t){function e(t,e,n,i,s){try{c?c-=1:r("err",[s||new UncaughtException(t,e,n)])}catch(f){try{r("ierr",[f,(new Date).getTime(),!0])}catch(u){}}return"function"==typeof a?a.apply(this,o(arguments)):!1}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function n(t){r("err",[t,(new Date).getTime()])}var r=t("handle"),o=t(4),i=t("ee"),a=window.onerror,s=!1,c=0;t("loader").features.err=!0,window.onerror=e,NREUM.noticeError=n;try{throw new Error}catch(f){"stack"in f&&(t(5),t(3),"addEventListener"in window&&t(1),window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&t(2),s=!0)}i.on("fn-start",function(){s&&(c+=1)}),i.on("fn-err",function(t,e,r){s&&(this.thrown=!0,n(r))}),i.on("fn-end",function(){s&&!this.thrown&&c>0&&(c-=1)}),i.on("internal-error",function(t){r("ierr",[t,(new Date).getTime(),!0])})},{1:4,2:7,3:5,4:15,5:6,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],4:[function(t,e){function n(t){i.inPlace(t,["addEventListener","removeEventListener"],"-",r)}function r(t){return t[1]}var o=(t(1),t("ee").create()),i=t(2)(o);if(e.exports=o,n(window),"getPrototypeOf"in Object){for(var a=document;a&&!a.hasOwnProperty("addEventListener");)a=Object.getPrototypeOf(a);a&&n(a);for(var s=XMLHttpRequest.prototype;s&&!s.hasOwnProperty("addEventListener");)s=Object.getPrototypeOf(s);s&&n(s)}else XMLHttpRequest.prototype.hasOwnProperty("addEventListener")&&n(XMLHttpRequest.prototype);o.on("addEventListener-start",function(t){if(t[1]){var e=t[1];"function"==typeof e?this.wrapped=e["nr@wrapped"]?t[1]=e["nr@wrapped"]:e["nr@wrapped"]=t[1]=i(e,"fn-",null,e.name||"anonymous"):"function"==typeof e.handleEvent&&i.inPlace(e,["handleEvent"],"fn-")}}),o.on("removeEventListener-start",function(t){var e=this.wrapped;e&&(t[1]=e)})},{1:15,2:16,ee:"QJf3ax"}],5:[function(t,e){var n=(t(2),t("ee").create()),r=t(1)(n);e.exports=n,r.inPlace(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame"],"raf-"),n.on("raf-start",function(t){t[0]=r(t[0],"fn-")})},{1:16,2:15,ee:"QJf3ax"}],6:[function(t,e){function n(t,e,n){var r=t[0];"string"==typeof r&&(r=new Function(r)),t[0]=o(r,"fn-",null,n)}var r=(t(2),t("ee").create()),o=t(1)(r);e.exports=r,o.inPlace(window,["setTimeout","setInterval","setImmediate"],"setTimer-"),r.on("setTimer-start",n)},{1:16,2:15,ee:"QJf3ax"}],7:[function(t,e){function n(){c.inPlace(this,d,"fn-")}function r(t,e){c.inPlace(e,["onreadystatechange"],"fn-")}function o(t,e){return e}var i=t("ee").create(),a=t(1),s=t(2),c=s(i),f=s(a),u=window.XMLHttpRequest,d=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"];e.exports=i,window.XMLHttpRequest=function(t){var e=new u(t);try{i.emit("new-xhr",[],e),f.inPlace(e,["addEventListener","removeEventListener"],"-",function(t,e){return e}),e.addEventListener("readystatechange",n,!1)}catch(r){try{i.emit("internal-error",r)}catch(o){}}return e},window.XMLHttpRequest.prototype=u.prototype,c.inPlace(XMLHttpRequest.prototype,["open","send"],"-xhr-",o),i.on("send-xhr-start",r),i.on("open-xhr-start",r)},{1:4,2:16,ee:"QJf3ax"}],8:[function(t){function e(t){if("string"==typeof t&&t.length)return t.length;if("object"!=typeof t)return void 0;if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if("undefined"!=typeof FormData&&t instanceof FormData)return void 0;try{return JSON.stringify(t).length}catch(e){return void 0}}function n(t){var n=this.params,r=this.metrics;if(!this.ended){this.ended=!0;for(var i=0;c>i;i++)t.removeEventListener(s[i],this.listener,!1);if(!n.aborted){if(r.duration=(new Date).getTime()-this.startTime,4===t.readyState){n.status=t.status;var a=t.responseType,f="arraybuffer"===a||"blob"===a||"json"===a?t.response:t.responseText,u=e(f);if(u&&(r.rxSize=u),this.sameOrigin){var d=t.getResponseHeader("X-NewRelic-App-Data");d&&(n.cat=d.split(", ").pop())}}else n.status=0;r.cbTime=this.cbTime,o("xhr",[n,r,this.startTime])}}}function r(t,e){var n=i(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}if(window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)){t("loader").features.xhr=!0;var o=t("handle"),i=t(1),a=t("ee"),s=["load","error","abort","timeout"],c=s.length,f=t(2);t(4),t(3),a.on("new-xhr",function(){this.totalCbs=0,this.called=0,this.cbTime=0,this.end=n,this.ended=!1,this.xhrGuids={}}),a.on("open-xhr-start",function(t){this.params={method:t[0]},r(this,t[1]),this.metrics={}}),a.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),a.on("send-xhr-start",function(t,n){var r=this.metrics,o=t[0],i=this;if(r&&o){var f=e(o);f&&(r.txSize=f)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(i.params.aborted=!0),("load"!==t.type||i.called===i.totalCbs&&(i.onloadCalled||"function"!=typeof n.onload))&&i.end(n)}catch(e){try{a.emit("internal-error",e)}catch(r){}}};for(var u=0;c>u;u++)n.addEventListener(s[u],this.listener,!1)}),a.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),a.on("xhr-load-added",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),a.on("xhr-load-removed",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),a.on("addEventListener-end",function(t,e){e instanceof XMLHttpRequest&&"load"===t[0]&&a.emit("xhr-load-added",[t[1],t[2]],e)}),a.on("removeEventListener-end",function(t,e){e instanceof XMLHttpRequest&&"load"===t[0]&&a.emit("xhr-load-removed",[t[1],t[2]],e)}),a.on("fn-start",function(t,e,n){e instanceof XMLHttpRequest&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),a.on("fn-end",function(t,e){this.xhrCbStart&&a.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{1:9,2:12,3:7,4:4,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],9:[function(t,e){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");return!r.port&&o[1]&&(r.port=o[1].split("/")[0].split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname),r.sameOrigin=!e.hostname||e.hostname===document.domain&&e.port===n.port&&e.protocol===n.protocol,r}},{}],D5DuLP:[function(t,e){function n(t,e,n){return r.listeners(t).length?r.emit(t,e,n):(o[t]||(o[t]=[]),void o[t].push(e))}var r=t("ee").create(),o={};e.exports=n,n.ee=r,r.q=o},{ee:"QJf3ax"}],handle:[function(t,e){e.exports=t("D5DuLP")},{}],12:[function(t,e){function n(t){if(!t||"object"!=typeof t&&"function"!=typeof t)return-1;if(t===window)return 0;if(o.call(t,"__nr"))return t.__nr;try{return Object.defineProperty(t,"__nr",{value:r,writable:!0,enumerable:!1}),r}catch(e){return t.__nr=r,r}finally{r+=1}}var r=1,o=Object.prototype.hasOwnProperty;e.exports=n},{}],loader:[function(t,e){e.exports=t("G9z0Bl")},{}],G9z0Bl:[function(t,e){function n(){var t=p.info=NREUM.info;if(t&&t.agent&&t.licenseKey&&t.applicationID&&c&&c.body){p.proto="https"===d.split(":")[0]||t.sslForHttp?"https://":"http://",a("mark",["onload",i()]);var e=c.createElement("script");e.src=p.proto+t.agent,c.body.appendChild(e)}}function r(){"complete"===c.readyState&&o()}function o(){a("mark",["domContent",i()])}function i(){return(new Date).getTime()}var a=t("handle"),s=window,c=s.document,f="addEventListener",u="attachEvent",d=(""+location).split("?")[0],p=e.exports={offset:i(),origin:d,features:{}};c[f]?(c[f]("DOMContentLoaded",o,!1),s[f]("load",n,!1)):(c[u]("onreadystatechange",r),s[u]("onload",n)),a("mark",["firstbyte",i()])},{handle:"D5DuLP"}],15:[function(t,e){function n(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=n},{}],16:[function(t,e){function n(t){return!(t&&"function"==typeof t&&t.apply&&!t[i])}var r=t("ee"),o=t(1),i="nr@wrapper";e.exports=function(t){function e(t,e,r,a){function nrWrapper(){var n,i,f,u;try{i=this,n=o(arguments),f=r&&r(n,i)||{}}catch(d){c([d,"",[n,i,a],f])}s(e+"start",[n,i,a],f);try{return u=t.apply(i,n)}catch(p){throw s(e+"err",[n,i,p],f),p}finally{s(e+"end",[n,i,u],f)}}return n(t)?t:(e||(e=""),nrWrapper[i]=!0,nrWrapper)}function a(t,r,o,i){o||(o="");var a,s,c,f="-"===o.charAt(0);for(c=0;c<r.length;c++)s=r[c],a=t[s],n(a)||(t[s]=e(a,f?s+o:o,i,s,t))}function s(e,n,r){try{t.emit(e,n,r)}catch(o){c([o,e,n,r])}}function c(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=r),e.inPlace=a,e.flag=i,e}},{1:15,ee:"QJf3ax"}]},{},["G9z0Bl",3,8]);</script>      <title>LRU cache implementation in C++</title> 
 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,xhtml --> 
<meta name="src" content="lru.tex"> 
<meta name="date" content="2012-05-19 00:44:00"> 
<link rel="stylesheet" type="text/css" href="./LRU cache implementation in C++_files/lru.css"> 
<style type="text/css"></style></head><body>
   <div class="maketitle">
                                                                     

                                                                     
                                                                     

                                                                     

<h2 class="titleHead">LRU cache implementation in C++</h2>
<div class="author"><span class="cmsy-10x-x-120">©</span><span class="pncr7t-x-x-120">2010-2012 Tim Day</span>
<br> <span class="pncr7t-x-x-120">timday@timday.com</span>
<br>  <a href="http://www.timday.com/"><span class="pncr7t-x-x-120">www.timday.com</span></a></div><br>
<div class="date"></div>
   </div><div class="abstract">
<div class="center">
<!--l. 41--><p class="noindent">
</p><!--l. 41--><p class="noindent"><span class="pncb7t-">Abstract</span></p></div>
     <!--l. 42--><p class="indent">     <span class="pncr7t-">A          key-value          container          providing          caching</span>
     <span class="pncr7t-">with  a  least-recently-used  replacement  strategy  is  a  useful  tool</span>
     <span class="pncr7t-">in  any  programmer’s  performance  optimisation  toolkit;  however,</span>
     <span class="pncr7t-">with  no  ready-to-use  implementations  provided  in  the  standard</span>
     <span class="pncr7t-">library or the widely used boost libraries, C++ developers are likely</span>
     <span class="pncr7t-">resort to inefficient or incorrect approximations to the logic. This</span>
     <span class="pncr7t-">document describes a couple of simple implementations built on</span>
     <span class="pncr7t-">top  of  the  C++  standard  library’s  map  types  and  on  the  boost</span>
     <span class="pncr7t-">library’s “bimap” types in the hope of making this useful pattern</span>
     <span class="pncr7t-">more accessible to coders not already familiar with it.</span>
</p>
</div>
   <h3 class="likesectionHead"><a id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc">1 <a href="http://timday.bitbucket.org/lru.html#x1-20001" id="QQ2-1-2">Document history</a></span>
<br>   <span class="sectionToc">2 <a href="http://timday.bitbucket.org/lru.html#x1-30002" id="QQ2-1-3">Source code licensing</a></span>
<br>   <span class="sectionToc">3 <a href="http://timday.bitbucket.org/lru.html#x1-40003" id="QQ2-1-4">The problem</a></span>
<br>   <span class="sectionToc">4 <a href="http://timday.bitbucket.org/lru.html#x1-50004" id="QQ2-1-5">Implementations</a></span>
                                                                     

                                                                     
<br>   <span class="sectionToc">5 <a href="http://timday.bitbucket.org/lru.html#x1-60005" id="QQ2-1-6">Standard Library based LRU-cache</a></span>
<br>   &nbsp;<span class="subsectionToc">5.1 <a href="http://timday.bitbucket.org/lru.html#x1-70005.1" id="QQ2-1-7">Design</a></span>
<br>   &nbsp;<span class="subsectionToc">5.2 <a href="http://timday.bitbucket.org/lru.html#x1-80005.2" id="QQ2-1-8">Implementation</a></span>
<br>   <span class="sectionToc">6 <a href="http://timday.bitbucket.org/lru.html#x1-90006" id="QQ2-1-10">Boost bimap-based LRU-cache</a></span>
<br>   &nbsp;<span class="subsectionToc">6.1 <a href="http://timday.bitbucket.org/lru.html#x1-100006.1" id="QQ2-1-11">Design</a></span>
<br>   &nbsp;<span class="subsectionToc">6.2 <a href="http://timday.bitbucket.org/lru.html#x1-110006.2" id="QQ2-1-12">Implementation</a></span>
<br>   <span class="sectionToc">7 <a href="http://timday.bitbucket.org/lru.html#x1-120007" id="QQ2-1-14">Testing</a></span>
<br>   &nbsp;<span class="subsectionToc">7.1 <a href="http://timday.bitbucket.org/lru.html#x1-130007.1" id="QQ2-1-16">Unit test</a></span>
<br>   &nbsp;<span class="subsectionToc">7.2 <a href="http://timday.bitbucket.org/lru.html#x1-140007.2" id="QQ2-1-18">Performance testing</a></span>
<br>   <span class="sectionToc">8 <a href="http://timday.bitbucket.org/lru.html#x1-150008" id="QQ2-1-22">Variations</a></span>
<br>   &nbsp;<span class="subsectionToc">8.1 <a href="http://timday.bitbucket.org/lru.html#x1-160008.1" id="QQ2-1-23">Definition of “capacity”</a></span>
<br>   &nbsp;<span class="subsectionToc">8.2 <a href="http://timday.bitbucket.org/lru.html#x1-170008.2" id="QQ2-1-24">Thread safety</a></span>
<br>   &nbsp;<span class="subsectionToc">8.3 <a href="http://timday.bitbucket.org/lru.html#x1-180008.3" id="QQ2-1-25">Compressed stored values</a></span>
<br>   &nbsp;<span class="subsectionToc">8.4 <a href="http://timday.bitbucket.org/lru.html#x1-190008.4" id="QQ2-1-26">Alternative strategies to LRU</a></span>
<br>   &nbsp;<span class="subsectionToc">8.5 <a href="http://timday.bitbucket.org/lru.html#x1-200008.5" id="QQ2-1-27">Pooling</a></span>
<br>   <span class="sectionToc">A <a href="http://timday.bitbucket.org/lru.html#x1-21000A" id="QQ2-1-28">Timer utility class</a></span>
   </div>
<!--l. 55--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a id="x1-20001"></a>Document history</h3>
     <ul class="itemize1">
     <li class="itemize">May 2012: Minor typo fixed in text.
     </li>
     <li class="itemize">October 2011: Updated for C++0x; added templating to permit use
     of both hash-based “unordered” maps and conventional tree-based
     maps. Updated performance results.
     </li>
     <li class="itemize">September  2011:  Bug  fixed  in  std-based  code  (in  operator(),
     erroneous  and  unnecessary  iterator  assignment  after  splice  -
     special  thanks  to  Marek  Fort  to  drawing  this  to  the  author’s
     attention).
     </li>
     <li class="itemize">March 2011: Source code licensing clarified.
     </li>
     <li class="itemize">December 2010: Initial version.</li></ul>
                                                                     

                                                                     
<!--l. 66--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">2    </span> <a id="x1-30002"></a>Source code licensing</h3>
<!--l. 68--><p class="noindent">While the general aim of this document is to provide its audience with
enough information to implement their own LRU-caching classes, readers
are welcome to cut-and-paste the code listings in this document under the
terms of the Internet Systems Consortium (ISC) license (an OSI-approved
BSD-alike license). The following text should be considered to apply to all
code in this document, and added as a comment in any code copied directly
from it:
</p>
   <!--l. 75-->
<div class="lstlisting" id="listing-1"><span class="label"><a id="x1-3001r1"></a></span><span class="pcrr7t-x-x-80">Copyright</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">(</span><span class="pcrr7t-x-x-80">c</span><span class="pcrr7t-x-x-80">)</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">2010-2011,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">Tim</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">Day</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">&lt;</span><span class="pcrr7t-x-x-80">timday@timday</span><span class="pcrr7t-x-x-80">.</span><span class="pcrr7t-x-x-80">com</span><span class="pcrr7t-x-x-80">&gt;</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3002r2"></a></span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3003r3"></a></span><span class="pcrr7t-x-x-80">Permission</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">to</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">use</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">copy</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">modify</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">and</span><span class="pcrr7t-x-x-80">/</span><span class="pcrr7t-x-x-80">or</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">distribute</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">this</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">software</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">for</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">any</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3004r4"></a></span><span class="pcrr7t-x-x-80">purpose</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">with</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">or</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">without</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">fee</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">is</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">hereby</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">granted</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">provided</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">that</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">the</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">above</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3005r5"></a></span><span class="pcrr7t-x-x-80">copyright</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">notice</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">and</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">this</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">permission</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">notice</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">appear</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">in</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">all</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">copies</span><span class="pcrr7t-x-x-80">.</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3006r6"></a></span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3007r7"></a></span><span class="pcrr7t-x-x-80">THE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">SOFTWARE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">PROVIDED</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">"</span><span class="pcrr7t-x-x-80">AS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IS</span><span class="pcrr7t-x-x-80">"</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">AND</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">THE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">AUTHOR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">DISCLAIMS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">ALL</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">WARRANTIES</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3008r8"></a></span><span class="pcrr7t-x-x-80">WITH</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">REGARD</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">TO</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">THIS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">SOFTWARE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">INCLUDING</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">ALL</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IMPLIED</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">WARRANTIES</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OF</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3009r9"></a></span><span class="pcrr7t-x-x-80">MERCHANTABILITY</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">AND</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">FITNESS</span><span class="pcrr7t-x-x-80">.</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IN</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">NO</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">EVENT</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">SHALL</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">THE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">AUTHOR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">BE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">LIABLE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">FOR</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3010r10"></a></span><span class="pcrr7t-x-x-80">ANY</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">SPECIAL</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">DIRECT</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">INDIRECT</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">CONSEQUENTIAL</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">DAMAGES</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">ANY</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">DAMAGES</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3011r11"></a></span><span class="pcrr7t-x-x-80">WHATSOEVER</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">RESULTING</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">FROM</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">LOSS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OF</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">USE</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">DATA</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">PROFITS</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">WHETHER</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IN</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">AN</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3012r12"></a></span><span class="pcrr7t-x-x-80">ACTION</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OF</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">CONTRACT</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">NEGLIGENCE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OTHER</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">TORTIOUS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">ACTION</span><span class="pcrr7t-x-x-80">,</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">ARISING</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OUT</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OF</span><span class="pcrr7t-x-x-80">&nbsp;</span><br><span class="label"><a id="x1-3013r13"></a></span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">IN</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">CONNECTION</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">WITH</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">THE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">USE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OR</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">PERFORMANCE</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">OF</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">THIS</span><span class="pcrr7t-x-x-80">&nbsp;</span><span class="pcrr7t-x-x-80">SOFTWARE</span><span class="pcrr7t-x-x-80">.</span>
   </div>
<!--l. 91--><p class="indent">   Readers simply looking for templated LRU cache code for instant usage
may wish to turn straight to <a href="http://timday.bitbucket.org/lru.html#x1-8007r1">Listing&nbsp;1</a> and the comments immediately
preceding it.
</p><!--l. 94--><p class="indent">   The sources are also available from a Bitbucket-hosted <a href="http://bitbucket.org/timday/lru_cache">Mercurial
repository</a>.
</p><!--l. 96--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a id="x1-40003"></a>The problem</h3>
<!--l. 98--><p class="noindent">The need for caching behaviour sometimes arises during system development.
Generally the desire is to preserve some expensive-to-obtain results so they
can be reused “for free” without repeating the expensive operation in future.
Typically the expense arises because a complex calculation is needed to
obtain the result, or because it must be obtained via a time consuming I/O
operation. If the total number of such results dealt with over the
lifetime of the system does not consume excessive memory, it may
suffice to store them in a simple key-value container (for example, a
<span class="pcrr7t-x-x-109">std::map</span>), with the key being the input to the expensive function and the
value being the result. This is often referred to as “memoisation” of a
function.
</p><!--l. 109--><p class="indent">   However, for most applications, this approach would quickly consume too
much memory to be of any practical value. The memory consumption issue
can be addressed by limiting the maximum number of items stored in the
cache or, if the items have a variable size, limiting the aggregate total stored.
Initially the cache is empty and records (key-value pairs) can be stored
in it freely. After some further usage, it will fill up. Once full, the
question arises of what to do with subsequent additional records which it
                                                                     

                                                                     
seems desirable to cache, but for which there is no space (given the
limited capacity constraint) without taking action to remove some other
records from the store. Assuming the records most recently added to the
cache are those most likely to be accessed again (ie assuming some
temporal coherence in the access sequence), a good general strategy is
to make way for a new record by deleting the record in the cache
which was “least recently used”. This is called an LRU replacement
strategy.
</p><!--l. 124--><p class="indent">   Despite the general utility of a LRU-replacement cache component, one is
not provided as such in C++’s Standard Library or in the well known Boost
libraries. However, it is reasonably easy logic to construct using either library
as a basis.
</p><!--l. 128--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">4    </span> <a id="x1-50004"></a>Implementations</h3>
<!--l. 130--><p class="noindent">The following two sections describe possible implementations, both of them
providing caching up to a limited number of records of a function with
signature <span class="pcrr7t-x-x-109">V f(K)</span>, where <span class="pcrr7t-x-x-109">K </span>and <span class="pcrr7t-x-x-109">V </span>are the “key type” and the “value type”.
The only real difference in the API to either implementation is that the
boost-based one passes the cached function as a <span class="pcrr7t-x-x-109">boost::function </span>rather
than a function pointer, providing slightly more flexibility through
compatibility with <span class="pcrr7t-x-x-109">boost::bind</span>.
</p><!--l. 139--><p class="indent">   The code presented has been tested on g++ 4.4.5. The <span class="pcrr7t-x-x-109">-std=c++0x </span>option
is required in order to use the <span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map </span>hash-based map
container which appeared with the TR1 additions to the C++ Standard
Library, and variadic template arguments are also used to bypass some
templated-template issues associated with the different type arguments to
the tree-based and hash-based container types.
</p><!--l. 145--><p class="indent">   For brevity the code explanations below will generally refer to the
<span class="pcrr7t-x-x-109">std::map </span>and <span class="pcrr7t-x-x-109">boost::bimaps::set</span><span class="pcrr7t-x-x-109">_of </span>versions of the code; however both
cache implementations work equally well (or better; see <a href="http://timday.bitbucket.org/lru.html#x1-140007.2">subsection&nbsp;7.2</a>) with
<span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map </span>and <span class="pcrr7t-x-x-109">boost::bimaps::unordered</span><span class="pcrr7t-x-x-109">_set</span><span class="pcrr7t-x-x-109">_of</span>
containers and the code presented is fully intended to support both, subject
to the key type supporting the necessary concepts (ordered comparison in the
case of <span class="pcrr7t-x-x-109">std::map </span>and <span class="pcrr7t-x-x-109">boost::bimaps::set</span><span class="pcrr7t-x-x-109">_of</span>, hashability and equality
testing in the case of the unordered variants).
</p><!--l. 152--><p class="noindent">
</p>
                                                                     

                                                                     
   <h3 class="sectionHead"><span class="titlemark">5    </span> <a id="x1-60005"></a>Standard Library based LRU-cache</h3>
<!--l. 155--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1    </span> <a id="x1-70005.1"></a>Design</h4>
<!--l. 156--><p class="noindent">Users of the C++ Standard Library needing an LRU-replacement cache
generally gravitate towards <span class="pcrr7t-x-x-109">std::map </span>or <span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map</span>, because
of their support for efficient keyed value accesses (<span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(</span><span class="cmr-10x-x-109">log</span> <span class="cmmi-10x-x-109">n</span><span class="cmr-10x-x-109">) </span>or <span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(1)</span>
access complexity). The problem then is how to implement the eviction
strategy.
</p><!--l. 160--><p class="indent">   The most obvious naive solution is to use an </p><!--l. 161-->
<div class="lstlisting" id="listing-2"><span class="label"><a id="x1-7001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">timestamp_type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span>
   </div>
<!--l. 165--><p class="indent">   The <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_t </span>holds a scalar quantity, the ordering of which indicates
when the value was last accessed relative to other values; typically some sort
of incrementing serial number is used rather than an actual clock-derived
time, to ensure a one-to-one mapping from timestamps to records. Keys
then give efficient access to values and timestamps, and timestamps
can be updated without the need to adjust the map’s tree-structure
(as this depends entirely on the key values). However, to determine
the minimum timestamp in order to evict a record, it is necessary to
perform a <span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(</span><span class="cmmi-10x-x-109">n</span><span class="cmr-10x-x-109">) </span>search over all the records to determine the oldest
one.
</p><!--l. 173--><p class="indent">   As a solution to eviction being expensive, it might be tempting to
implement the cache as a </p><!--l. 174-->
<div class="lstlisting" id="listing-3"><span class="label"><a id="x1-7002r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span>
   </div>
<!--l. 177--><p class="indent">   Moving any item accessed to the tail of the list (a cheap operation for
lists), ensures the least-recently-used item can trivially be obtained (for
erasure) at the list head by <span class="pcrr7t-x-x-109">begin()</span>. However, this just moves the problem
elsewhere as it is now necessary to resort to an <span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(</span><span class="cmmi-10x-x-109">n</span><span class="cmr-10x-x-109">) </span>search simply to look up
a key in the cache.
</p><!--l. 182--><p class="indent">   While either naive solution can be got to work (and may well be a
simple pragmatic solution to caching a few tens of items) certainly
neither can be considered scalable or efficient due to the <span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(</span><span class="cmmi-10x-x-109">n</span><span class="cmr-10x-x-109">) </span>behaviour
associated with either identifying eviction targets or accessing values by
key.
</p><!--l. 186--><p class="indent">   However, it is possible to implement an LRU-replacement cache with
efficient eviction <span class="pncri7t-x-x-109">and </span>access using a pair of maps: </p><!--l. 188-->
                                                                     

                                                                     
<div class="lstlisting" id="listing-4"><span class="label"><a id="x1-7003r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">timestamp_type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">timestamp_to_key_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7004r2"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7005r3"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7006r4"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">timestamp_type</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7007r5"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">;</span>
   </div>
<!--l. 195--><p class="indent">   On accessing <span class="pcrr7t-x-x-109">key</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_value </span>by a key, we obtain access to both the value
required and the timestamp, which can be updated in both the accessed
record and, by lookup, <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_key</span>. When an eviction is required,
the lowest timestamp in <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_key </span>provides the key to the record
which must be erased.
</p><!--l. 200--><p class="indent">   However, this can actually be optimised slightly: </p><!--l. 201-->
<div class="lstlisting" id="listing-5"><span class="label"><a id="x1-7008r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">timestamp_type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">timestamp_to_key_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7009r2"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7010r3"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7011r4"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">timestamp_to_key_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-7012r5"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">;</span>
   </div>
<!--l. 208--><p class="indent">   This has the slight advantage that updating the timestamp on a record
access avoids an keyed lookup into <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_key</span>, replacing it with a
(presumably more efficient) direct iterator access.
</p><!--l. 211--><p class="indent">   Pedants will observe that further slight improvement would also have
the <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_key</span><span class="pcrr7t-x-x-109">_type </span>map’s value be an iterator into the
<span class="pcrr7t-x-x-109">key</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_value</span><span class="pcrr7t-x-x-109">_type </span>but this introduces a circular type definition. It might
be tempting to try to break the dependency by using <span class="pcrr7t-x-x-109">void&#8902; </span>in place of the
iterator, but iterators cannot portably be cast to pointers. In any case, the
first iterator optimisation mentioned benefits the updating of timestamps
needed during cache hits whereas this second iterator optimisation benefits
the eviction associated with cache misses. Since in a well functioning cached
system cache hits should be far more common than misses, this second
optimisation is likely of much less value than the first. Another consideration
is that whatever expensive operation is required to generate a new result
following a cache miss is likely to be hugely more expensive than any
keyed access. Therefore this second optimisation is not considered
further.
</p><!--l. 223--><p class="indent">   In fact there <span class="pncri7t-x-x-109">is </span>one final powerful optimisation possible. The only
operations actually done on <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_to</span><span class="pcrr7t-x-x-109">_key </span>are to access its head
(lowest timestamp, least recently used) element, or to move elements to the
(most recently used) tail. Therefore it can be replaced by a <span class="pcrr7t-x-x-109">std::list</span>; this
also eliminates the need for any actual instances of <span class="pcrr7t-x-x-109">timestamp</span><span class="pcrr7t-x-x-109">_type </span>(and
therefore any concerns about the timestamp possibly overflowing). In
previous testing the author has found list-and-map implementations
to be almost twice as fast as a version (not shown) using a pair of
maps.
</p><!--l. 232--><p class="indent">   Finally, before showing the complete implementation, there is one
other detail to consider: it would seem to be desirable to template the
cache class code on the underlying container type used (<span class="pcrr7t-x-x-109">std::map </span>or
<span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map</span>) rather than provide two completely separate
implementations which actually only differ in minor details. This is slightly
                                                                     

                                                                     
complicated by the different type argument signatures of the container types
own templates (providing the optional capability to override default
comparator or hasher/equality predicate logic as appropriate), but a simple
workround is to declare the map type as templated on variadic type
arguments <span class="pcrr7t-x-x-109">template&lt;typename...&gt; class MAP </span>and then the actual
container instance required can simply be instantiated on the necessary key
and value types. Generalising the code to support overriding of the default
comparator (or the unordered map type equivalent) or allocators is left as an
exercise for the reader.
</p><!--l. 244--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2    </span> <a id="x1-80005.2"></a>Implementation</h4>
<!--l. 246--><p class="noindent">See <a href="http://timday.bitbucket.org/lru.html#x1-8007r1">Listing&nbsp;1</a> for a complete example using the pair of containers
</p><!--l. 247-->
<div class="lstlisting" id="listing-6"><span class="label"><a id="x1-8001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8002r2"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">MAP</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8003r3"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8004r4"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">;</span>
   </div>
<!--l. 253--><p class="indent">   where MAP is expected to be one of <span class="pcrr7t-x-x-109">std::map </span>or <span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map</span>;
for example an LRU cache from <span class="pcrr7t-x-x-109">std::string </span>to <span class="pcrr7t-x-x-109">std::string </span>using
hashing would be declared as </p><!--l. 255-->
<div class="lstlisting" id="listing-7"><span class="label"><a id="x1-8005r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">unordered_map</span><span class="pcrr7t-">&gt;</span>
   </div>
<!--l. 258--><p class="indent">   while an int-keyed cache of Foo objects using the “classic” <span class="pcrr7t-x-x-109">std::map</span>
would be declared as </p><!--l. 259-->
<div class="lstlisting" id="listing-8"><span class="label"><a id="x1-8006r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">shared_ptr</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">Foo</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&gt;</span>
   </div>
<!--l. 262--><p class="indent">   Note that use of a reference counted smart-pointer for heap-allocated
value types is strongly advised as the very nature of caches easily leads to
situations where value object ownership must be considered shared
between the cache and a client which has retrieved the value from the
cache.
</p>
   <!--l. 266--><div class="lstinputlisting">
<a id="x1-8007r1"></a>
<a id="x1-8008"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;1:
    </span><span class="content">lru_cache_using_std.h</span></div><!--tex4ht:label?: x1-8007r5 --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8009r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">ifndef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_using_std_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8010r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_using_std_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8011r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8012r4"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">cassert</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8013r5"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8014r6"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8015r7"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Class</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">providing</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fixed</span><span class="pcrro7t-">-</span><span class="pcrro7t-">size</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">by</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">records</span><span class="pcrro7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8016r8"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">LRU</span><span class="pcrro7t-">-</span><span class="pcrro7t-">replacement</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">with</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">signature</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8017r9"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">V</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">f</span><span class="pcrro7t-">(</span><span class="pcrro7t-">K</span><span class="pcrro7t-">)</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8018r10"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">MAP</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">should</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">one</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">std</span><span class="pcrro7t-">::</span><span class="pcrro7t-">map</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">or</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">std</span><span class="pcrro7t-">::</span><span class="pcrro7t-">unordered_map</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8019r11"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Variadic</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">template</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">args</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">deal</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">with</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8020r12"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">different</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">type</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">argument</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">signatures</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">those</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8021r13"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">containers</span><span class="pcrro7t-">;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">default</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">comparator</span><span class="pcrro7t-">/</span><span class="pcrro7t-">hash</span><span class="pcrro7t-">/</span><span class="pcrro7t-">allocator</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8022r14"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8023r15"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8024r16"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8025r17"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8026r18"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">template</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">...&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">class</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">MAP</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8027r19"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">class</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8028r20"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8029r21"></a></span><span class="pcrb7t-">public</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8030r22"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8031r23"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8032r24"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8033r25"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8034r26"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">history</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">most</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recent</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">back</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8035r27"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8036r28"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8037r29"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">history</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">iterator</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8038r30"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">MAP</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8039r31"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8040r32"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">pair</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8041r33"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8042r34"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8043r35"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8044r36"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8045r37"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8046r38"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Constuctor</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">specifies</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8047r39"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">maximum</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">records</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">stored</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8048r40"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8049r41"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(&#8902;</span><span class="pcrr7t-">f</span><span class="pcrr7t-">)</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8050r42"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">c</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8051r43"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8052r44"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">:</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">(</span><span class="pcrr7t-">f</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8053r45"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">(</span><span class="pcrr7t-">c</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8054r46"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8055r47"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">!=0)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8056r48"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8057r49"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8058r50"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Obtain</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">k</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8059r51"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">operator</span><span class="pcrr7t-">()</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8060r52"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8061r53"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Attempt</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">find</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">existing</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8062r54"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8063r55"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">find</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8064r56"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8065r57"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">it</span><span class="pcrr7t-">==</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8066r58"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8067r59"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">We</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">don</span><span class="pcrro7t-">'</span><span class="pcrro7t-">t</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">it</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8068r60"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8069r61"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Evaluate</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">new</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8070r62"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8071r63"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrr7t-">v</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8072r64"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8073r65"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Return</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">freshly</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">computed</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8074r66"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8075r67"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8076r68"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">else</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8077r69"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8078r70"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">We</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">do</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">it</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8079r71"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8080r72"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Update</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">by</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">moving</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8081r73"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">accessed</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">back</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">list</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8082r74"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">splice</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8083r75"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8084r76"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8085r77"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(&#8902;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">.</span><span class="pcrr7t-">second</span><span class="pcrr7t-">.</span><span class="pcrr7t-">second</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8086r78"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8087r79"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8088r80"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Return</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">retrieved</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8089r81"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(&#8902;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">.</span><span class="pcrr7t-">second</span><span class="pcrr7t-">.</span><span class="pcrr7t-">first</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8090r82"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8091r83"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8092r84"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8093r85"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Obtain</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">most</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">element</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8094r86"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">head</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">tail</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8095r87"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">This</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">method</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">provided</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">purely</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">support</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">testing</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8096r88"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">IT</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">get_keys</span><span class="pcrr7t-">(</span><span class="pcrr7t-">IT</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">dst</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8097r89"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">const_reverse_iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">src</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8098r90"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rbegin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8099r91"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">while</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">src</span><span class="pcrr7t-">!=</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rend</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8100r92"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&#8902;</span><span class="pcrr7t-">dst</span><span class="pcrr7t-">++</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&#8902;</span><span class="pcrr7t-">src</span><span class="pcrr7t-">++;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8101r93"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8102r94"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8103r95"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8104r96"></a></span><span class="pcrb7t-">private</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8105r97"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8106r98"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Record</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fresh</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">-</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">pair</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">in</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8107r99"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8108r100"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8109r101"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Method</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">only</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">called</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">on</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">misses</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8110r102"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">find</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">==</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8111r103"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8112r104"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Make</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">space</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">if</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">necessary</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8113r105"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">==</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8114r106"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">evict</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8115r107"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8116r108"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Record</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">k</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">as</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">most</span><span class="pcrro7t-">-</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">-</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8117r109"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8118r110"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8119r111"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8120r112"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">-</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">entry</span><span class="pcrro7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8121r113"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">linked</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">usage</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8122r114"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8123r115"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">make_pair</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8124r116"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8125r117"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">make_pair</span><span class="pcrr7t-">(</span><span class="pcrr7t-">v</span><span class="pcrr7t-">,</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8126r118"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8127r119"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8128r120"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">No</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">need</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">check</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">return</span><span class="pcrro7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8129r121"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">given</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">previous</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">assert</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8130r122"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8131r123"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8132r124"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Purge</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">-</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">-</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">element</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">in</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8133r125"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">evict</span><span class="pcrr7t-">()</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8134r126"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8135r127"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Assert</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">method</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">never</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">called</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">when</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">empty</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8136r128"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(!</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">empty</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8137r129"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8138r130"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Identify</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8139r131"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8140r132"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">find</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">front</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8141r133"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">it</span><span class="pcrr7t-">!=</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8142r134"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8143r135"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Erase</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">both</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">elements</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">completely</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">purge</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8144r136"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">.</span><span class="pcrr7t-">erase</span><span class="pcrr7t-">(</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8145r137"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">.</span><span class="pcrr7t-">pop_front</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8146r138"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8147r139"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8148r140"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">The</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8149r141"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(&#8902;</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">)</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8150r142"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8151r143"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Maximum</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">-</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">pairs</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">retained</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8152r144"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8153r145"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8154r146"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">history</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8155r147"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_tracker_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_tracker</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8156r148"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8157r149"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Key</span><span class="pcrro7t-">-</span><span class="pcrro7t-">to</span><span class="pcrro7t-">-</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">lookup</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8158r150"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_to_value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_key_to_value</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8159r151"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8160r152"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-8161r153"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">endif</span>
                                                                     

                                                                     
   </div>
<!--l. 268--><p class="indent">   Readers interested in the performance impact of choosing <span class="pcrr7t-x-x-109">std::map </span>vs.
<span class="pcrr7t-x-x-109">std::unordered</span><span class="pcrr7t-x-x-109">_map </span>will find some results in <a href="http://timday.bitbucket.org/lru.html#x1-140007.2">subsection&nbsp;7.2</a>.
</p><!--l. 271--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">6    </span> <a id="x1-90006"></a>Boost bimap-based LRU-cache</h3>
<!--l. 274--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.1    </span> <a id="x1-100006.1"></a>Design</h4>
<!--l. 275--><p class="noindent">Assuming usage of the <a href="http://www.boost.org/">boost C++ libraries</a> is an option, <a href="http://www.boost.org/doc/libs/1_42_0/libs/bimap/doc/html/index.html"><span class="pcrr7t-x-x-109">boost::bimap</span></a>
provides an excellent basis on which to construct LRU-replacement cache
logic. Unlike the better known <span class="pcrr7t-x-x-109">std::map</span>, which has an asymmetric relation
between key and value (that is, a key can index a value but a value can’t
index a key), <span class="pcrr7t-x-x-109">boost::bimap </span>supports a bidirectional mapping between a
pair of keys. This is very convenient for indexing a cache’s collection using
either the cached-function argument key or the key-access history as
required, and much of the complication of the standard-library version
described in <a href="http://timday.bitbucket.org/lru.html#x1-60005">section&nbsp;5</a> can be avoided.
</p><!--l. 285--><p class="indent">   As with the standard library based implementation above, it is not
actually necessary to record timestamps explicitly and it suffices for the
access-history view of the bimap to be a <span class="pcrr7t-x-x-109">list</span><span class="pcrr7t-x-x-109">_of</span>, which can maintain the
ordering of keys accessed. By default <span class="pcrr7t-x-x-109">bimap </span>inserts new records at the
tail of the list view, and records can be efficiently relocated there on
access.
</p><!--l. 291--><p class="indent">   There are several ways in which the boost::bimap container to be used
might be instantiated. The most obvious one is </p><!--l. 293-->
<div class="lstlisting" id="listing-9"><span class="label"><a id="x1-10001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10002r2"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">set_of</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10003r3"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list_of</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10004r4"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">;</span>
   </div>
<!--l. 299--><p class="indent">   with the left view providing the key-to-value semantics, and the ordering
on the right view used to maintain a record of the key-value-pair access
history. Replacing the <span class="pcrr7t-x-x-109">set</span><span class="pcrr7t-x-x-109">_of </span>with <span class="pcrr7t-x-x-109">unordered</span><span class="pcrr7t-x-x-109">_set</span><span class="pcrr7t-x-x-109">_of </span>to use hashing
instead of trees is another choice.
</p><!--l. 303--><p class="indent">   However, there also exists the possibility of declaring </p><!--l. 304-->
<div class="lstlisting" id="listing-10"><span class="label"><a id="x1-10005r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10006r2"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">set_of</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10007r3"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list_of</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">dummy_type</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10008r4"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">with_info</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-10009r5"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">;</span>
                                                                     

                                                                     
   </div>
<!--l. 311--><p class="indent">   with the cached value stored using bimap’s support for “additional
information” and <span class="pcrr7t-x-x-109">dummy</span><span class="pcrr7t-x-x-109">_type </span>never storing a meaningful value. In the past
the author has found some peculiar performance differences between
implementations using a <span class="pcrr7t-x-x-109">with</span><span class="pcrr7t-x-x-109">_info </span>version of the container and those
without, but this seems to no longer be the case so only the simpler version
without <span class="pcrr7t-x-x-109">with</span><span class="pcrr7t-x-x-109">_info </span>is considered further here.
</p><!--l. 318--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.2    </span> <a id="x1-110006.2"></a>Implementation</h4>
<!--l. 320--><p class="noindent">See <a href="http://timday.bitbucket.org/lru.html#x1-11002r2">Listing&nbsp;2</a> for a complete implementation. This is similar to the standard
library-based version in that it is templated on the key view template to
be used which is expected be one of <span class="pcrr7t-x-x-109">boost::bimaps::set</span><span class="pcrr7t-x-x-109">_of </span>or
<span class="pcrr7t-x-x-109">boost::bimaps::unordered</span><span class="pcrr7t-x-x-109">_set</span><span class="pcrr7t-x-x-109">_of</span>. For example an LRU cache from
<span class="pcrr7t-x-x-109">std::string </span>to <span class="pcrr7t-x-x-109">std::string </span>using hashing would be declared as
</p><!--l. 324-->
<div class="lstlisting" id="listing-11"><span class="label"><a id="x1-11001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">unordered_set_of</span><span class="pcrr7t-">&gt;</span>
   </div>
   <!--l. 328--><div class="lstinputlisting">
<a id="x1-11002r2"></a>
<a id="x1-11003"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;2:
    </span><span class="content">lru_cache_using_boost.h</span></div><!--tex4ht:label?: x1-11002r6 --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11004r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">ifndef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_using_boost_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11005r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_using_boost_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11006r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11007r4"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11008r5"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">/</span><span class="pcrr7t-">list_of</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11009r6"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">/</span><span class="pcrr7t-">set_of</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11010r7"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">function</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11011r8"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">cassert</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11012r9"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11013r10"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Class</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">providing</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fixed</span><span class="pcrro7t-">-</span><span class="pcrro7t-">size</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">by</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">records</span><span class="pcrro7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11014r11"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">LRU</span><span class="pcrro7t-">-</span><span class="pcrro7t-">replacement</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">with</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">signature</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11015r12"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">V</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">f</span><span class="pcrro7t-">(</span><span class="pcrro7t-">K</span><span class="pcrro7t-">)</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11016r13"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">SET</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">expected</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">one</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">boost</span><span class="pcrro7t-">::</span><span class="pcrro7t-">bimaps</span><span class="pcrro7t-">::</span><span class="pcrro7t-">set_of</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11017r14"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">or</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">boost</span><span class="pcrro7t-">::</span><span class="pcrro7t-">bimaps</span><span class="pcrro7t-">::</span><span class="pcrro7t-">unordered_set_of</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11018r15"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11019r16"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11020r17"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11021r18"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">...&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">class</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">SET</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11022r19"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">class</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11023r20"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11024r21"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">public</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11025r22"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11026r23"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11027r24"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11028r25"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11029r26"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11030r27"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">SET</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11031r28"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list_of</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11032r29"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11033r30"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11034r31"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Constuctor</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">specifies</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11035r32"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">maximum</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">records</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">stored</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11036r33"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11037r34"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">function</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;)</span><span class="pcrr7t-">&gt;&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">f</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11038r35"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">c</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11039r36"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11040r37"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">:</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">(</span><span class="pcrr7t-">f</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11041r38"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">(</span><span class="pcrr7t-">c</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11042r39"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11043r40"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">!=0)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11044r41"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11045r42"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11046r43"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Obtain</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">k</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11047r44"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">operator</span><span class="pcrr7t-">()</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11048r45"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11049r46"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Attempt</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">find</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">existing</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11050r47"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">left_iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11051r48"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">left</span><span class="pcrr7t-">.</span><span class="pcrr7t-">find</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11052r49"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11053r50"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">it</span><span class="pcrr7t-">==</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">left</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11054r51"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11055r52"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">We</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">don</span><span class="pcrro7t-">'</span><span class="pcrro7t-">t</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">it</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11056r53"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11057r54"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Evaluate</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">new</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11058r55"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11059r56"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrr7t-">v</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11060r57"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11061r58"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Return</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">freshly</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">computed</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11062r59"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11063r60"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11064r61"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">else</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11065r62"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11066r63"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">We</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">do</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">it</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11067r64"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11068r65"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Update</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">view</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11069r66"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">relocate</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11070r67"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11071r68"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">project_right</span><span class="pcrr7t-">(</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11072r69"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11073r70"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11074r71"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Return</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">retrieved</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11075r72"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">-&gt;</span><span class="pcrr7t-">second</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11076r73"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11077r74"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11078r75"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11079r76"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Obtain</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cached</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">most</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">element</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11080r77"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">head</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">tail</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11081r78"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">This</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">method</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">provided</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">purely</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">support</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">testing</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11082r79"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">IT</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">get_keys</span><span class="pcrr7t-">(</span><span class="pcrr7t-">IT</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">dst</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11083r80"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">right_const_reverse_iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">src</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11084r81"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">=</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rbegin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11085r82"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">while</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">src</span><span class="pcrr7t-">!=</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rend</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11086r83"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&#8902;</span><span class="pcrr7t-">dst</span><span class="pcrr7t-">++=(&#8902;</span><span class="pcrr7t-">src</span><span class="pcrr7t-">++)</span><span class="pcrr7t-">.</span><span class="pcrr7t-">second</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11087r84"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11088r85"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11089r86"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11090r87"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">private</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11091r88"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11092r89"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">v</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11093r90"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11094r91"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">assert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">&lt;=</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11095r92"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11096r93"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">If</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">necessary</span><span class="pcrro7t-">,</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">make</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">space</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11097r94"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">==</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11098r95"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">by</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">purging</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">-</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">-</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">element</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11099r96"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">erase</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">right</span><span class="pcrr7t-">.</span><span class="pcrr7t-">begin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11100r97"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11101r98"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11102r99"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">new</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">record</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">from</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">value</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11103r100"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">bimap</span><span class="pcrro7t-">'</span><span class="pcrro7t-">s</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">list_view</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">defaults</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">inserting</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">this</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">at</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11104r101"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">list</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">tail</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">considered</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">most</span><span class="pcrro7t-">-</span><span class="pcrro7t-">recently</span><span class="pcrro7t-">-</span><span class="pcrro7t-">used</span><span class="pcrro7t-">)</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11105r102"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">.</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11106r103"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrr7t-">v</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11107r104"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11108r105"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11109r106"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11110r107"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">function</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">value_type</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&amp;)</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_fn</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11111r108"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_capacity</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11112r109"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">container_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_container</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11113r110"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11114r111"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-11115r112"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">endif</span>
   </div>
<!--l. 330--><p class="indent">   See <a href="http://timday.bitbucket.org/lru.html#x1-140007.2">subsection&nbsp;7.2</a> for some comparative performance testing between
the tree and hash based versions, and between bimap-based caches and
conventional standard library map based caches.
</p><!--l. 333--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">7    </span> <a id="x1-120007"></a>Testing</h3>
<!--l. 335--><p class="noindent">Both test codes below make use of the header <a href="http://timday.bitbucket.org/lru.html#x1-12003r3">Listing&nbsp;3</a> which brings
together both standard library and boost bimap based implementations and
defines some helper types. This permits, for example </p><!--l. 338-->
<div class="lstlisting" id="listing-12"><span class="label"><a id="x1-12001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">unordered_set_of</span><span class="pcrr7t-">&gt;</span>
                                                                     

                                                                     
   </div>
<!--l. 341--><p class="indent">   to be written </p><!--l. 342-->
<div class="lstlisting" id="listing-13"><span class="label"><a id="x1-12002r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_unordered_set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span>
   </div>
   <!--l. 346--><div class="lstinputlisting">
<a id="x1-12003r3"></a>
<a id="x1-12004"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;3:
    </span><span class="content">lru_cache.h</span></div><!--tex4ht:label?: x1-12003r7 --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12005r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">ifndef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_h_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12006r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_lru_cache_h_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12007r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12008r4"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Bring</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">all</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">necessary</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">includes</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">together</span><span class="pcrro7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12009r5"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">define</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">some</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">type</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">helpers</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12010r6"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12011r7"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12012r8"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">unordered_map</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12013r9"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">.</span><span class="pcrr7t-">h</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12014r10"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12015r11"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">/</span><span class="pcrr7t-">set_of</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12016r12"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">bimap</span><span class="pcrr7t-">/</span><span class="pcrr7t-">unordered_set_of</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12017r13"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">.</span><span class="pcrr7t-">h</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12018r14"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12019r15"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">See</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">http</span><span class="pcrro7t-">://</span><span class="pcrro7t-">www</span><span class="pcrro7t-">.</span><span class="pcrro7t-">gotw</span><span class="pcrro7t-">.</span><span class="pcrro7t-">ca</span><span class="pcrro7t-">/</span><span class="pcrro7t-">gotw</span><span class="pcrro7t-">/079.</span><span class="pcrro7t-">htm</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">why</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">we</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">can</span><span class="pcrro7t-">'</span><span class="pcrro7t-">t</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12020r16"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">just</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">use</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">templated</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">typedef</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12021r17"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12022r18"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">struct</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_map</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12023r19"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">map</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12024r20"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12025r21"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12026r22"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">struct</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_unordered_map</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12027r23"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">unordered_map</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12028r24"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12029r25"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12030r26"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">struct</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_set</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12031r27"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">set_of</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12032r28"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12033r29"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12034r30"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">V</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">struct</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_unordered_set</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12035r31"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">,</span><span class="pcrr7t-">V</span><span class="pcrr7t-">,</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">bimaps</span><span class="pcrr7t-">::</span><span class="pcrr7t-">unordered_set_of</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12036r32"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12037r33"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-12038r34"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">endif</span>
   </div>
<!--l. 348--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">7.1    </span> <a id="x1-130007.1"></a>Unit test</h4>
<!--l. 350--><p class="noindent"><a href="http://timday.bitbucket.org/lru.html#x1-13001r4">Listing&nbsp;4</a> contains templated <span class="pcrr7t-x-x-109">boost::test </span>code to exercise all four cache
implementations and check basic behaviour is as expected.
</p>
   <!--l. 353--><div class="lstinputlisting">
<a id="x1-13001r4"></a>
<a id="x1-13002"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;4:
    </span><span class="content">lru_test.cpp</span></div><!--tex4ht:label?: x1-13001r7 --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13003r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_TEST_DYN_LINK</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13004r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_TEST_MODULE</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_test</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13005r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13006r4"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">iostream</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13007r5"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13008r6"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13009r7"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13010r8"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test</span><span class="pcrr7t-">/</span><span class="pcrr7t-">unit_test</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13011r9"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test_case_template</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13012r10"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">mpl</span><span class="pcrr7t-">/</span><span class="pcrr7t-">list</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13013r11"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13014r12"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">lru_cache</span><span class="pcrr7t-">.</span><span class="pcrr7t-">h</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13015r13"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13016r14"></a></span><span class="pcrb7t-">namespace</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">=0;}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13017r15"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13018r16"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Dummy</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">we</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">want</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13019r17"></a></span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">s</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13020r18"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13021r19"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">++</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13022r20"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13023r21"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">copy</span><span class="pcrr7t-">(</span><span class="pcrr7t-">s</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rbegin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">s</span><span class="pcrr7t-">.</span><span class="pcrr7t-">rend</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">back_inserter</span><span class="pcrr7t-">(</span><span class="pcrr7t-">r</span><span class="pcrr7t-">)</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13024r22"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13025r23"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13026r24"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13027r25"></a></span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">mpl</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13028r26"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13029r27"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_unordered_map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13030r28"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13031r29"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_unordered_set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">,</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13032r30"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">test_types</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13033r31"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13034r32"></a></span><span class="pcrr7t-">BOOST_AUTO_TEST_CASE_TEMPLATE</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13035r33"></a></span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13036r34"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_test</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13037r35"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13038r36"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">test_types</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13039r37"></a></span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13040r38"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13041r39"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13042r40"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13043r41"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">,5)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13044r42"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13045r43"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Some</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">initial</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">accesses</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">prime</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">state</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13046r44"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">first</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">tsrif</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13047r45"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">second</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">dnoces</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13048r46"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">third</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">driht</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13049r47"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fourth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htruof</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13050r48"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fifth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htfif</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13051r49"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,5)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13052r50"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">sixth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htxis</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13053r51"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,6)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13054r52"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13055r53"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">This</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">should</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">retrieved</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">from</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13056r54"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">second</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">dnoces</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13057r55"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,6)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13058r56"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13059r57"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">This</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">been</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">evicted</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13060r58"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">first</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">tsrif</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13061r59"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,7)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13062r60"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13063r61"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">contents</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">by</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">time</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13064r62"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">most</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recent</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">least</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">recent</span><span class="pcrro7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13065r63"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">should</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">now</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13066r64"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">first</span><span class="pcrro7t-">,</span><span class="pcrro7t-">second</span><span class="pcrro7t-">,</span><span class="pcrro7t-">sixth</span><span class="pcrro7t-">,</span><span class="pcrro7t-">fifth</span><span class="pcrro7t-">,</span><span class="pcrro7t-">fourth</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13067r65"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13068r66"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13069r67"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">first</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13070r68"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">second</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13071r69"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">sixth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13072r70"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fifth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13073r71"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fourth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13074r72"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">actual</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13075r73"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">.</span><span class="pcrr7t-">get_keys</span><span class="pcrr7t-">(</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">back_inserter</span><span class="pcrr7t-">(</span><span class="pcrr7t-">actual</span><span class="pcrr7t-">)</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13076r74"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK</span><span class="pcrr7t-">(</span><span class="pcrr7t-">actual</span><span class="pcrr7t-">==</span><span class="pcrr7t-">expected</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13077r75"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13078r76"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13079r77"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">So</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">check</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fourth</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">retrieved</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13080r78"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fourth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htruof</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13081r79"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,7)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13082r80"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13083r81"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">That</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">have</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">moved</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">up</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">"</span><span class="pcrro7t-">fourth</span><span class="pcrro7t-">"</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">head</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13084r82"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">so</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">this</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">evict</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fifth</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13085r83"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">seventh</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htneves</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13086r84"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,8)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13087r85"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13088r86"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Check</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fifth</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">was</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">evicted</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">as</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">expected</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13089r87"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">fifth</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">"</span><span class="pcrr7t-">htfif</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13090r88"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_CHECK_EQUAL</span><span class="pcrr7t-">(</span><span class="pcrr7t-">count_evaluations</span><span class="pcrr7t-">,9)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-13091r89"></a></span><span class="pcrr7t-">}</span>
   </div>
<!--l. 355--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">7.2    </span> <a id="x1-140007.2"></a>Performance testing</h4>
<!--l. 358--><p class="noindent"><a href="http://timday.bitbucket.org/lru.html#x1-14004r5">Listing&nbsp;5</a> contains test code to examine the performance of all four cache
implementations. It makes use of a timer utility class which is provided in
<a href="http://timday.bitbucket.org/lru.html#x1-21001r6">Listing&nbsp;6</a> (NB this makes use of the TR1 “chrono” addition to the standard
library).
</p><!--l. 362--><p class="indent">   In order to test only pure cache performance, a trivial operation is used
for the cached function. The code tests a 1024 element capacity cache with a
series of random accesses over a smaller or larger range. When the the load
is less than or equal to <span class="cmr-10x-x-109">100%</span>, accesses are guaranteed to find a record already
                                                                     

                                                                     
in the cache, and the performance reflects the cost of simply finding it and
updating the access timestamp. When the load is over <span class="cmr-10x-x-109">100%</span>, the excess
determines the expected proportion of accesses which will result in cache
misses; these have a higher cost as deletion of a previous record and creation
of a new one is required and this is more complex than simply adjusting a
timestamp. Hence in the <span class="cmr-10x-x-109">112</span><span class="cmmi-10x-x-109">.</span><span class="cmr-10x-x-109">5% </span>load test, one in nine accesses are expected
to be a miss, and in the <span class="cmr-10x-x-109">200% </span>load case, on average half of all accesses should
miss.
</p><!--l. 374--><p class="indent">   Two key-value types are tested: </p>
     <ul class="itemize1">
     <li class="itemize"><span class="pcrr7t-x-x-109">int </span>to  <span class="pcrr7t-x-x-109">int</span>:  Random  keys  over  the  full  integer  range,  with  the
     cached function simply being the identity.
     </li>
     <li class="itemize"><span class="pcrr7t-x-x-109">std::wstring </span>to   <span class="pcrr7t-x-x-109">int</span>:   Random   256   character   strings   (of
     <span class="pcrr7t-x-x-109">wchar</span><span class="pcrr7t-x-x-109">_t</span>), with the cached function simply being the string length.</li></ul>
<!--l. 381--><p class="indent">   <a href="http://timday.bitbucket.org/lru.html#x1-140021">Table&nbsp;1</a> and <a href="http://timday.bitbucket.org/lru.html#x1-140032">Table&nbsp;2</a> shows performance results obtained on a 2.66GHz
Intel Q9450 Core2 running Debian Squeeze (32bit) when compiled with
</p><!--l. 382-->
<div class="lstlisting" id="listing-14"><span class="label"><a id="x1-14001r1"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">g</span><span class="pcrr7t-">++</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">std</span><span class="pcrr7t-">=</span><span class="pcrr7t-">c</span><span class="pcrr7t-">++0</span><span class="pcrr7t-">x</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">march</span><span class="pcrr7t-">=</span><span class="pcrr7t-">native</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">O3</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">DNDEBUG</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">o</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_perf</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_perf</span><span class="pcrr7t-">.</span><span class="pcrr7t-">cpp</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">-</span><span class="pcrr7t-">lboost_unit_test_framework</span>
   </div>
<!--l. 385--><p class="indent">   Software versions are g++ 4.4.5, boost 1.42.
</p>
   <div class="table">
                                                                     

                                                                     
<!--l. 387--><p class="indent">   <a id="x1-140021"></a></p><hr class="float"><div class="float">
                                                                     

                                                                     
 <div class="caption"><span class="id">Table&nbsp;1: </span><span class="content">int-to-int cache performance test results (Mega-accesses per
second)</span></div><!--tex4ht:label?: x1-140021 -->
<div class="tabular"> <table id="TBL-2" class="tabular" cellspacing="0" cellpadding="0" rules="groups"><colgroup id="TBL-2-1g"><col id="TBL-2-1"></colgroup><colgroup id="TBL-2-2g"><col id="TBL-2-2"><col id="TBL-2-3"></colgroup><colgroup id="TBL-2-4g"><col id="TBL-2-4"><col id="TBL-2-5"></colgroup><tbody><tr style="vertical-align:baseline;" id="TBL-2-1-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-1-1" class="td11">Cache</td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-2-1-2" class="td11">  <div class="multicolumn" style="white-space:nowrap; text-align:center;">Standard Library</div>   </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-2-1-4" class="td11">       <div class="multicolumn" style="white-space:nowrap; text-align:center;">boost bimap</div>
</td></tr><tr style="vertical-align:baseline;" id="TBL-2-2-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-2-1" class="td11"> load   </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-2-2-2" class="td11">    <div class="multicolumn" style="white-space:nowrap; text-align:center;">container type</div>    </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-2-2-4" class="td11">       <div class="multicolumn" style="white-space:nowrap; text-align:center;">key view type</div>
</td></tr><tr style="vertical-align:baseline;" id="TBL-2-3-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-3-1" class="td11">      </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-3-2" class="td11"><span class="pcrr7t-x-x-109">map</span></td><td style="white-space:nowrap; text-align:center;" id="TBL-2-3-3" class="td11"><span class="pcrr7t-x-x-109">unordered</span><span class="pcrr7t-x-x-109">_map</span></td><td style="white-space:nowrap; text-align:center;" id="TBL-2-3-4" class="td11"><span class="pcrr7t-x-x-109">set</span><span class="pcrr7t-x-x-109">_of</span></td><td style="white-space:nowrap; text-align:center;" id="TBL-2-3-5" class="td11"><span class="pcrr7t-x-x-109">unordered</span><span class="pcrr7t-x-x-109">_set</span><span class="pcrr7t-x-x-109">_of</span></td>
</tr><tr class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr style="vertical-align:baseline;" id="TBL-2-4-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-4-1" class="td11"> 50%   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-4-2" class="td11">14.4</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-4-3" class="td11">     41.8           </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-4-4" class="td11"> 13.4   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-4-5" class="td11">      36.3              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-2-5-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-5-1" class="td11"> 87.5% </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-5-2" class="td11">11.6</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-5-3" class="td11">     35.1           </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-5-4" class="td11"> 11.9   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-5-5" class="td11">      34.4              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-2-6-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-6-1" class="td11"> 100%  </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-6-2" class="td11">11.6</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-6-3" class="td11">     34.4           </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-6-4" class="td11"> 11.9   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-6-5" class="td11">      34.8              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-2-7-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-7-1" class="td11">112.5%</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-7-2" class="td11">7.78</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-7-3" class="td11">     17.2           </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-7-4" class="td11"> 8.91   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-7-5" class="td11">      23.2              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-2-8-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-8-1" class="td11"> 200%  </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-8-2" class="td11">3.72</td><td style="white-space:nowrap; text-align:center;" id="TBL-2-8-3" class="td11">     7.53           </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-8-4" class="td11"> 4.87   </td><td style="white-space:nowrap; text-align:center;" id="TBL-2-8-5" class="td11">      11.6              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-2-9-"><td style="white-space:nowrap; text-align:center;" id="TBL-2-9-1" class="td11">      </td></tr></tbody></table></div>
                                                                     

                                                                     
   </div><hr class="endfloat">
   </div>
   <div class="table">
                                                                     

                                                                     
<!--l. 403--><p class="indent">   <a id="x1-140032"></a><a id="x1-14004r5"></a><a id="x1-21001r6"></a></p><hr class="float"><div class="float">
                                                                     

                                                                     
 <div class="caption"><span class="id">Table&nbsp;2:  </span><span class="content">256-character  std::wstring-to-int  cache  performance  test
results (Mega-accesses per second)</span></div><!--tex4ht:label?: x1-140032 -->
<div class="tabular"> <table id="TBL-3" class="tabular" cellspacing="0" cellpadding="0" rules="groups"><colgroup id="TBL-3-1g"><col id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col id="TBL-3-2"><col id="TBL-3-3"></colgroup><colgroup id="TBL-3-4g"><col id="TBL-3-4"><col id="TBL-3-5"></colgroup><tbody><tr style="vertical-align:baseline;" id="TBL-3-1-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-1-1" class="td11">Cache</td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-3-1-2" class="td11">   <div class="multicolumn" style="white-space:nowrap; text-align:center;">Standard Library</div>    </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-3-1-4" class="td11">       <div class="multicolumn" style="white-space:nowrap; text-align:center;">boost bimap</div>
</td></tr><tr style="vertical-align:baseline;" id="TBL-3-2-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-2-1" class="td11"> load   </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-3-2-2" class="td11">    <div class="multicolumn" style="white-space:nowrap; text-align:center;">container type</div>     </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-3-2-4" class="td11">       <div class="multicolumn" style="white-space:nowrap; text-align:center;">key view type</div>
</td></tr><tr style="vertical-align:baseline;" id="TBL-3-3-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-3-1" class="td11">      </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-3-2" class="td11"> <span class="pcrr7t-x-x-109">map </span></td><td style="white-space:nowrap; text-align:center;" id="TBL-3-3-3" class="td11"><span class="pcrr7t-x-x-109">unordered</span><span class="pcrr7t-x-x-109">_map</span></td><td style="white-space:nowrap; text-align:center;" id="TBL-3-3-4" class="td11"><span class="pcrr7t-x-x-109">set</span><span class="pcrr7t-x-x-109">_of</span></td><td style="white-space:nowrap; text-align:center;" id="TBL-3-3-5" class="td11"><span class="pcrr7t-x-x-109">unordered</span><span class="pcrr7t-x-x-109">_set</span><span class="pcrr7t-x-x-109">_of</span></td>
</tr><tr class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr style="vertical-align:baseline;" id="TBL-3-4-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-4-1" class="td11"> 50%   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-4-2" class="td11"> 1.66 </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-4-3" class="td11">    0.515          </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-4-4" class="td11"> 1.56   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-4-5" class="td11">       1.1               </td>
</tr><tr style="vertical-align:baseline;" id="TBL-3-5-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-5-1" class="td11"> 87.5% </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-5-2" class="td11"> 1.58 </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-5-3" class="td11">    0.515          </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-5-4" class="td11"> 1.49   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-5-5" class="td11">      1.09              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-3-6-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-6-1" class="td11"> 100%  </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-6-2" class="td11"> 1.57 </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-6-3" class="td11">    0.513          </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-6-4" class="td11"> 1.49   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-6-5" class="td11">      1.09              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-3-7-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-7-1" class="td11">112.5%</td><td style="white-space:nowrap; text-align:center;" id="TBL-3-7-2" class="td11"> 1.4  </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-7-3" class="td11">    0.422          </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-7-4" class="td11"> 1.49   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-7-5" class="td11">      1.02              </td>
</tr><tr style="vertical-align:baseline;" id="TBL-3-8-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-8-1" class="td11"> 200%  </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-8-2" class="td11">0.996</td><td style="white-space:nowrap; text-align:center;" id="TBL-3-8-3" class="td11">    0.261          </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-8-4" class="td11"> 1.48   </td><td style="white-space:nowrap; text-align:center;" id="TBL-3-8-5" class="td11">      0.815             </td>
</tr><tr style="vertical-align:baseline;" id="TBL-3-9-"><td style="white-space:nowrap; text-align:center;" id="TBL-3-9-1" class="td11">      </td></tr></tbody></table></div>
                                                                     

                                                                     
   </div><hr class="endfloat">
   </div>
<!--l. 419--><p class="indent">   The main conclusions which can be drawn from these results are:
</p>
     <ul class="itemize1">
     <li class="itemize">Performance   differences   between   hash-based   and   tree-based
     containers  can  be  significant.  This  should  hardly  be  surprising
     given the different algorithmic complexity (<span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(</span><span class="cmr-10x-x-109">log</span> <span class="cmmi-10x-x-109">n</span><span class="cmr-10x-x-109">) </span>vs. <span class="cmmi-10x-x-109">O</span><span class="cmr-10x-x-109">(1)</span>) of key
     lookup.
     </li>
     <li class="itemize">The string-key results demonstrate that hash based caches are not
     automatically better. In fact this test case was constructed to probe
     the  “cross  over  point”  at  which  a  tree-based  container  becomes
     more efficient than caching; for shorter string lengths the balance
     shifts back in favour of hashing.
     </li>
     <li class="itemize">Performance differences between the boost and standard library
     based  implementations  are  not  so  simple  to  declare  one  or
     the  other  as  obviously  superior.  It  might  be  possible  to  make
     the  generalisation  that  the  standard  library  based  performs
     better   when   lightly   loaded   (few   cache   misses)   while   the
     boost  implementation  performs  better  under  heavy  load  (high
     proportion of cache misses), but this is not actually true over all
     results obtained.</li></ul>
<!--l. 429--><p class="noindent">Of course these results should not be taken as a substitute for readers carrying
out performance testing on their own systems using realistic test cases
relevant to their own usage.
</p>
   <!--l. 432--><div class="lstinputlisting">
<a id="x1-14005"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;5:
    </span><span class="content">lru_perf.cpp</span></div><!--tex4ht:label?: x1-14004r7 --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14006r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_TEST_DYN_LINK</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14007r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">BOOST_TEST_MODULE</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_perf</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14008r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14009r4"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">format</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14010r5"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">lexical_cast</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14011r6"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test</span><span class="pcrr7t-">/</span><span class="pcrr7t-">unit_test</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14012r7"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test</span><span class="pcrr7t-">/</span><span class="pcrr7t-">test_case_template</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14013r8"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">mpl</span><span class="pcrr7t-">/</span><span class="pcrr7t-">list</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14014r9"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">random</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14015r10"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">iostream</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14016r11"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">set</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14017r12"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14018r13"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14019r14"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">lru_cache</span><span class="pcrr7t-">.</span><span class="pcrr7t-">h</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14020r15"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">scoped_timer</span><span class="pcrr7t-">.</span><span class="pcrr7t-">h</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14021r16"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14022r17"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Random</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">number</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">source</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">generating</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">test</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">data</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14023r18"></a></span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">mt19937</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">rng</span><span class="pcrr7t-">(</span><span class="pcrro7t-">/&#8902;</span><span class="pcrro7t-">seed</span><span class="pcrro7t-">=</span><span class="pcrro7t-">&#8902;/</span><span class="pcrr7t-">23)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14024r19"></a></span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">random_number_generator</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14025r20"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">mt19937</span><span class="pcrr7t-">,</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14026r21"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">rnd</span><span class="pcrr7t-">(</span><span class="pcrr7t-">rng</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14027r22"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14028r23"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Functions</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">collections</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">test</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14029r24"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14030r25"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">General</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">pattern</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14031r26"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">make_keys</span><span class="pcrr7t-">(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14032r27"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14033r28"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Integer</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">specialization</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14034r29"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">generate</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">n</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">unique</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">integer</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14035r30"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">make_keys</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14036r31"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14037r32"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">set</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14038r33"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">do</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14039r34"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrb7t-">static_cast</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">rng</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14040r35"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">while</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14041r36"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">begin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14042r37"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14043r38"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14044r39"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">String</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">specialization</span><span class="pcrro7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14045r40"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">generate</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">n</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">unique</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">long</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">strings</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14046r41"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">make_keys</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14047r42"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14048r43"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Sufficiently</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">long</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">lengths</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">favour</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">comparator</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14049r44"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">based</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">containers</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">over</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">hashed</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14050r45"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">keylength</span><span class="pcrr7t-">=256;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14051r46"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14052r47"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14053r48"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">do</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14054r49"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">s</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14055r50"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">for</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">keylength</span><span class="pcrr7t-">;++</span><span class="pcrr7t-">i</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14056r51"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">s</span><span class="pcrr7t-">+=</span><span class="pcrb7t-">static_cast</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">wchar_t</span><span class="pcrr7t-">&gt;(1+</span><span class="pcrr7t-">rnd</span><span class="pcrr7t-">(65535)</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14057r52"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">insert</span><span class="pcrr7t-">(</span><span class="pcrr7t-">s</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14058r53"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">while</span><span class="pcrr7t-">(</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14059r54"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">begin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">r</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14060r55"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14061r56"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14062r57"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Extract</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">relevant</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">part</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">__PRETTY_FUNCTION__</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">text</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14063r58"></a></span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">shrink_pretty_function_text</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14064r59"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">s</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14065r60"></a></span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14066r61"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14067r62"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">c</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14068r63"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">for</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">=</span><span class="pcrr7t-">s</span><span class="pcrr7t-">.</span><span class="pcrr7t-">find</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">=</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">+2;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">s</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">-1;++</span><span class="pcrr7t-">i</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14069r64"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">c</span><span class="pcrr7t-">&lt;=1)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">+=</span><span class="pcrr7t-">s</span><span class="pcrr7t-">[</span><span class="pcrr7t-">i</span><span class="pcrr7t-">];</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14070r65"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">s</span><span class="pcrr7t-">[</span><span class="pcrr7t-">i</span><span class="pcrr7t-">]==</span><span class="pcrr7t-">'</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">'</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">++</span><span class="pcrr7t-">c</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14071r66"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">s</span><span class="pcrr7t-">[</span><span class="pcrr7t-">i</span><span class="pcrr7t-">]==</span><span class="pcrr7t-">'</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">'</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrb7t-">if</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">c</span><span class="pcrr7t-">==2)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">+=</span><span class="pcrr7t-">"</span><span class="pcrr7t-">...&gt;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">;--</span><span class="pcrr7t-">c</span><span class="pcrr7t-">;}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14072r67"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14073r68"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">r</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14074r69"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14075r70"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14076r71"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Test</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">object</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">capacity</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">n</span><span class="pcrro7t-">)</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">with</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">k</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14077r72"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">accesses</span><span class="pcrro7t-">.</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Benchmark</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">adapts</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">CACHE</span><span class="pcrro7t-">::</span><span class="pcrro7t-">key_type</span><span class="pcrro7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14078r73"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">but</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">expects</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">an</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">int</span><span class="pcrro7t-">-</span><span class="pcrro7t-">like</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">CACHE</span><span class="pcrro7t-">::</span><span class="pcrro7t-">value_type</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14079r74"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">void</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14080r75"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14081r76"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14082r77"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">k</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14083r78"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">a</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14084r79"></a></span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14085r80"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14086r81"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">::</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14087r82"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14088r83"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">The</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">set</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">m</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">keys</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">be</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">used</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">testing</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14089r84"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">keys</span><span class="pcrr7t-">=</span><span class="pcrr7t-">make_keys</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14090r85"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14091r86"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Create</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">random</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">sequence</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">plus</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">some</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">"</span><span class="pcrro7t-">primer</span><span class="pcrro7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14092r87"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14093r88"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">for</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">a</span><span class="pcrr7t-">+</span><span class="pcrr7t-">n</span><span class="pcrr7t-">;++</span><span class="pcrr7t-">i</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14094r89"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">.</span><span class="pcrr7t-">push_back</span><span class="pcrr7t-">(</span><span class="pcrr7t-">keys</span><span class="pcrr7t-">[</span><span class="pcrr7t-">i</span><span class="pcrr7t-">%</span><span class="pcrr7t-">k</span><span class="pcrr7t-">])</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14095r90"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">random_shuffle</span><span class="pcrr7t-">(</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">.</span><span class="pcrr7t-">begin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">,</span><span class="pcrr7t-">rnd</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14096r91"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14097r92"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Prime</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">so</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">timed</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">results</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">reflect</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14098r93"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">"</span><span class="pcrro7t-">steady</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">state</span><span class="pcrro7t-">",</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">not</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">ramp</span><span class="pcrro7t-">-</span><span class="pcrro7t-">up</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">period</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14099r94"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">for</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">i</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">;++</span><span class="pcrr7t-">i</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14100r95"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">[</span><span class="pcrr7t-">i</span><span class="pcrr7t-">])</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14101r96"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14102r97"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Setup</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">timing</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14103r98"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">scoped_timer</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">timer</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14104r99"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">str</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14105r100"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">format</span><span class="pcrr7t-">(</span><span class="pcrr7t-">"</span><span class="pcrr7t-">%1%</span><span class="pcrr7t-">&#9251;</span><span class="pcrr7t-">load</span><span class="pcrr7t-">&#9251;</span><span class="pcrr7t-">%|2</span><span class="pcrr7t-">$4</span><span class="pcrr7t-">.1</span><span class="pcrr7t-">f</span><span class="pcrr7t-">|%%</span><span class="pcrr7t-">"</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14106r101"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">shrink_pretty_function_text</span><span class="pcrr7t-">(</span><span class="pcrr7t-">__PRETTY_FUNCTION__</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14107r102"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">k</span><span class="pcrr7t-">&#8902;100.0/</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14108r103"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14109r104"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">Maccesses</span><span class="pcrr7t-">"</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14110r105"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">a</span><span class="pcrr7t-">/</span><span class="pcrb7t-">static_cast</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">float</span><span class="pcrr7t-">&gt;(1&lt;&lt;20)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14111r106"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14112r107"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14113r108"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Run</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">access</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">sequence</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14114r109"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">t</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14115r110"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">for</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14116r111"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">vector</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">const_iterator</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">=</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14117r112"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">.</span><span class="pcrr7t-">begin</span><span class="pcrr7t-">()</span><span class="pcrr7t-">+</span><span class="pcrr7t-">n</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14118r113"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">!=</span><span class="pcrr7t-">seq</span><span class="pcrr7t-">.</span><span class="pcrr7t-">end</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14119r114"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">++</span><span class="pcrr7t-">it</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14120r115"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14121r116"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">t</span><span class="pcrr7t-">+=</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(&#8902;</span><span class="pcrr7t-">it</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14122r117"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14123r118"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Avoid</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">"</span><span class="pcrro7t-">optimised</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">away</span><span class="pcrro7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14124r119"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">volatile</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">force</span><span class="pcrr7t-">=0;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14125r120"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">force</span><span class="pcrr7t-">=</span><span class="pcrr7t-">t</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14126r121"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14127r122"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14128r123"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Classes</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">we</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">want</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">test</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14129r124"></a></span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">mpl</span><span class="pcrr7t-">::</span><span class="pcrr7t-">list</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14130r125"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_map</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14131r126"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_unordered_map</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14132r127"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_set</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14133r128"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_unordered_set</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14134r129"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14135r130"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14136r131"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_std_unordered_map</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14137r132"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14138r133"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_cache_using_boost_unordered_set</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">,</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;::</span><span class="pcrr7t-">type</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14139r134"></a></span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">test_types</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14140r135"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14141r136"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Some</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">lightweight</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">functions</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">to</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14142r137"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">the</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">key</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">types</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">interest</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14143r138"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14144r139"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">K</span><span class="pcrr7t-">&amp;)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14145r140"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14146r141"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&gt;(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">x</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14147r142"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">x</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14148r143"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14149r144"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14150r145"></a></span><span class="pcrb7t-">template</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&gt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">int</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&gt;(</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">wstring</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">x</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14151r146"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">return</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">x</span><span class="pcrr7t-">.</span><span class="pcrr7t-">size</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14152r147"></a></span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14153r148"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14154r149"></a></span><span class="pcrr7t-">BOOST_AUTO_TEST_CASE_TEMPLATE</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14155r150"></a></span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14156r151"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru_perf</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14157r152"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14158r153"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">test_types</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14159r154"></a></span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14160r155"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">size_t</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">=1024;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14161r156"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14162r157"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">(</span><span class="pcrr7t-">fn</span><span class="pcrr7t-">&lt;</span><span class="pcrb7t-">typename</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">CACHE</span><span class="pcrr7t-">::</span><span class="pcrr7t-">key_type</span><span class="pcrr7t-">&gt;,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14163r158"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14164r159"></a></span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Test</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">variety</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">of</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">cache</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">load</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">levels</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14165r160"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">/2</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,1024&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14166r161"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,(7&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">/8,1024&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14167r162"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,1024&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14168r163"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,(9&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">/8,1024&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14169r164"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">benchmark</span><span class="pcrr7t-">(</span><span class="pcrr7t-">lru</span><span class="pcrr7t-">,</span><span class="pcrr7t-">n</span><span class="pcrr7t-">,2&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,1024&#8902;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14170r165"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">cout</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&lt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">endl</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-14171r166"></a></span><span class="pcrr7t-">}</span>
   </div>
   <h3 class="sectionHead"><span class="titlemark">8    </span> <a id="x1-150008"></a>Variations</h3>
<!--l. 436--><p class="noindent">There are numerous ways in which basic caching behaviour can be extended.
Here are a few suggestions.
                                                                     

                                                                     
</p><!--l. 439--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.1    </span> <a id="x1-160008.1"></a>Definition of “capacity”</h4>
<!--l. 441--><p class="noindent">In many applications for caches, it is required to define the cache capacity
not simply as a maximum number of cached elements, but rather in terms of
the total of some measure on the elements. For example, a utility for
browsing a collection of image files might include a cache of loaded
raster images keyed by filename so as to avoid re-loading the most
recently viewed images if the user revisits them. A cache which simply
stored a fixed number of images would not have very predictable
(ie bounded) memory consumption due to the enormous variation
in image sizes which could be encountered. However, by taking the
size-in-bytes of the stored images into account, the maximum total memory
consumed by cached objects could be controlled and the number of
images cached automatically adjusted in response to the aggregate
size.
</p><!--l. 454--><p class="indent">   Implementation of such a cache is left as an exercise for the reader. Hint:
It will be necessary to provide some mechanism (another function object?) for
determining the capacity consumed by each stored record, to track the
aggregate total currently cached, and to call the <span class="pcrr7t-x-x-109">evict() </span>method within a
loop to possibly free up multiple elements in order to make sufficient space
for insertion of a single large elements.
</p><!--l. 461--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.2    </span> <a id="x1-170008.2"></a>Thread safety</h4>
<!--l. 463--><p class="noindent">It should be obvious how to trivially make a cache implementation
thread-safe by addition of a suitable mutex as a member and locking it for
the scope of the access operation. Bear in mind that caches can easily become
a serialisation bottleneck because, unlike simpler containers with no state
mutated on read, multiple readers cannot simply ignore each other as even a
cache-hitting read access must update the access record. Possibly
some benefit might be gained from using an <a href="http://www.boost.org/doc/libs/1_42_0/doc/html/thread/synchronization.html#thread.synchronization.locks.upgrade_lock">upgradeable lock</a> to limit
the time for which exclusive access is required to the minimum. For
cache hits, exclusivity can be limited to the access history update, but
for cache misses the situation is more complicated because several
non-exclusive threads could cache miss the same key simultaneously and
it is probably desirable for the exclusive-scope code to handle this
case efficiently and ideally only compute the corresponding value
once.
                                                                     

                                                                     
</p><!--l. 477--><p class="indent">   In some cases the best solution might be for multiple threads to each
maintain their own independent cache: the inefficiency introduced by
duplication of some cache-miss calculations must be weighed against the
overheads introduced by sharing a cache between multiple threads.
</p><!--l. 481--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3    </span> <a id="x1-180008.3"></a>Compressed stored values</h4>
<!--l. 483--><p class="noindent">Depending on the nature of the stored result values in the cache, it may be
possible to reduce the amount of memory used by the cache (or, more usefully,
cache more records in the same amount of memory) by compressing the
result values. Storing a value in the cache will incur a compression overhead,
and retrieving each value will require a decompression, but if the
costs of these is small compared with the original operation required
to obtain the value then it may be worth the expense to obtain an
overall improvement in system performance through a better cache hit
rate.
</p><!--l. 492--><p class="indent">   A further refinement might be two levels of caching; one holding
compressed values, and a smaller one holding the most recent decompressed
values in anticipation of near-term reuse.
</p><!--l. 496--><p class="indent">   See also <a href="http://www.boost.org/doc/libs/1_42_0/libs/flyweight/doc/index.html"><span class="pcrr7t-x-x-109">boost::flyweight</span></a>, which may be of use as a cache-size
reducer in situations where many records in the cache actually hold the
same value (this would imply the cached function is “many-to-one” in
character).
</p><!--l. 501--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4    </span> <a id="x1-190008.4"></a>Alternative strategies to LRU</h4>
<!--l. 503--><p class="noindent">For some specialist use cases, alternative strategies might be appropriate.
For example, a most-recently-used (MRU) replacement strategy evicts the
record most recently added to the cache; this might be relevant where cached
results generated earliest in the lifetime of a program are most likely to be
reused, or it can be a useful strategy to switch to in cases where a program
repeatedly loops over a sequence of records slightly too large for the cache to
store fully. Alternatively, a cache might have access to additional information
(a so-called “clairvoyant algorithm”) which predicts the cached values to be
used in future and thereby be able to select records for eviction so as to
minimise the amount of recalculation subsequently needing to be
done.
                                                                     

                                                                     
</p><!--l. 514--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.5    </span> <a id="x1-200008.5"></a>Pooling</h4>
<!--l. 516--><p class="noindent">Consider a fully populated cache, which should be considered to be the
normal state for caches after they have been in existence for some time.
Cache misses result in the deletion of an evicted stored result value,
followed by the immediate creation of a new one. If the value type is
particularly expensive to create there may be a potential optimisation in
recycling evicted values through a simple object pool for more efficient
reuse.
</p><!--l. 526--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">A    </span> <a id="x1-21000A"></a>Timer utility class</h3>
<!--l. 527--><p class="noindent"><a href="http://timday.bitbucket.org/lru.html#x1-21001r6">Listing&nbsp;6</a> contains the timer utility class used by the performance testing
code in <a href="http://timday.bitbucket.org/lru.html#x1-14004r5">Listing&nbsp;5</a>. </p><!--l. 528--><div class="lstinputlisting">
<a id="x1-21001r6"></a>
<a id="x1-21002"></a>
<br>
    <div class="caption"><span class="id">Listing&nbsp;6:
    </span><span class="content">scoped_timer.h</span></div><!--tex4ht:label?: x1-21001rA --><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21003r1"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">ifndef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_scoped_timer_h_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21004r2"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">define</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_scoped_timer_h_</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21005r3"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21006r4"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">/</span><span class="pcrr7t-">noncopyable</span><span class="pcrr7t-">.</span><span class="pcrr7t-">hpp</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21007r5"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">chrono</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21008r6"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">include</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">iostream</span><span class="pcrr7t-">&gt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21009r7"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21010r8"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">Utility</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">class</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">for</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">timing</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">logging</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">rates</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21011r9"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">ie</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">"</span><span class="pcrro7t-">things</span><span class="pcrro7t-">-</span><span class="pcrro7t-">per</span><span class="pcrro7t-">-</span><span class="pcrro7t-">second</span><span class="pcrro7t-">")</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21012r10"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">NB</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">_any_</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">destructor</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">invokation</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">(</span><span class="pcrro7t-">including</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">early</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">return</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21013r11"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">from</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">a</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">function</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">or</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">exception</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">throw</span><span class="pcrro7t-">)</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">trigger</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">an</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21014r12"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">output</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">which</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">will</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">assume</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">that</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">whatever</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">is</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">being</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">measured</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21015r13"></a></span><span class="pcrro7t-">//</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">has</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">completed</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">successfully</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">and</span><span class="pcrro7t-">&nbsp;</span><span class="pcrro7t-">fully</span><span class="pcrro7t-">.</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21016r14"></a></span><span class="pcrb7t-">class</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">scoped_timer</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">noncopyable</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21017r15"></a></span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21018r16"></a></span><span class="pcrb7t-">public</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21019r17"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21020r18"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">typedef</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">chrono</span><span class="pcrr7t-">::</span><span class="pcrr7t-">high_resolution_clock</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">clock_type</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21021r19"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21022r20"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">scoped_timer</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21023r21"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">what</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21024r22"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&amp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">units</span><span class="pcrr7t-">,</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21025r23"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">double</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">n</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21026r24"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21027r25"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">:</span><span class="pcrr7t-">_what</span><span class="pcrr7t-">(</span><span class="pcrr7t-">what</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21028r26"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,</span><span class="pcrr7t-">_units</span><span class="pcrr7t-">(</span><span class="pcrr7t-">units</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21029r27"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,</span><span class="pcrr7t-">_how_many</span><span class="pcrr7t-">(</span><span class="pcrr7t-">n</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21030r28"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">,</span><span class="pcrr7t-">_start</span><span class="pcrr7t-">(</span><span class="pcrr7t-">clock_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">now</span><span class="pcrr7t-">()</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21031r29"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21032r30"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21033r31"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">~</span><span class="pcrr7t-">scoped_timer</span><span class="pcrr7t-">()</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">{</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21034r32"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">clock_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">time_point</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">stop</span><span class="pcrr7t-">=</span><span class="pcrr7t-">clock_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">now</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21035r33"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">double</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">t</span><span class="pcrr7t-">=</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21036r34"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">1</span><span class="pcrr7t-">e</span><span class="pcrr7t-">-9&#8902;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">chrono</span><span class="pcrr7t-">::</span><span class="pcrr7t-">duration_cast</span><span class="pcrr7t-">&lt;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21037r35"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">chrono</span><span class="pcrr7t-">::</span><span class="pcrr7t-">nanoseconds</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21038r36"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&gt;(</span><span class="pcrr7t-">stop</span><span class="pcrr7t-">-</span><span class="pcrr7t-">_start</span><span class="pcrr7t-">)</span><span class="pcrr7t-">.</span><span class="pcrr7t-">count</span><span class="pcrr7t-">()</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21039r37"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">cout</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&lt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21040r38"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">boost</span><span class="pcrr7t-">::</span><span class="pcrr7t-">format</span><span class="pcrr7t-">(</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21041r39"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">"</span><span class="pcrr7t-">%1%:</span><span class="pcrr7t-">&#9251;</span><span class="pcrr7t-">%|2</span><span class="pcrr7t-">$</span><span class="pcrr7t-">-5.3</span><span class="pcrr7t-">g</span><span class="pcrr7t-">|</span><span class="pcrr7t-">&#9251;</span><span class="pcrr7t-">%|3</span><span class="pcrr7t-">$</span><span class="pcrr7t-">|/</span><span class="pcrr7t-">s</span><span class="pcrr7t-">&#9251;</span><span class="pcrr7t-">(%|4</span><span class="pcrr7t-">$</span><span class="pcrr7t-">-5.3</span><span class="pcrr7t-">g</span><span class="pcrr7t-">|</span><span class="pcrr7t-">s</span><span class="pcrr7t-">)</span><span class="pcrr7t-">"</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21042r40"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_what</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">(</span><span class="pcrr7t-">_how_many</span><span class="pcrr7t-">/</span><span class="pcrr7t-">t</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_units</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">%</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">t</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21043r41"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">)</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&lt;&lt;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">endl</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21044r42"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">}</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21045r43"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21046r44"></a></span><span class="pcrb7t-">private</span><span class="pcrr7t-">:</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21047r45"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21048r46"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_what</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21049r47"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">std</span><span class="pcrr7t-">::</span><span class="pcrr7t-">string</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_units</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21050r48"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">double</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_how_many</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21051r49"></a></span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">&nbsp;</span><span class="pcrb7t-">const</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">clock_type</span><span class="pcrr7t-">::</span><span class="pcrr7t-">time_point</span><span class="pcrr7t-">&nbsp;</span><span class="pcrr7t-">_start</span><span class="pcrr7t-">;</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21052r50"></a></span><span class="pcrr7t-">};</span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21053r51"></a></span><span class="pcrr7t-">&nbsp;</span><br><span class="label"><a id="x1-21054r52"></a></span><span class="pcrb7t-">#</span><span class="pcrb7t-">endif</span>
   </div>
    
 

                                                                     


<table width="100%">
<tbody><tr>
<td align="right">
  <a target="_top" href="http://www.sitemeter.com/stats.asp?site=bottlenosewebcounter" id="idSiteMeterHREF"><img border="0" alt="Site Meter" src="./LRU cache implementation in C++_files/meter.asp"></a><iframe frameborder="0" width="0" height="0" src="about:blank" style="display: none !important; visibility: hidden !important; opacity: 0 !important; background-position: 0px 0px;"></iframe><script type="text/javascript" src="http://s21.sitemeter.com/js/counter.js?site=bottlenosewebcounter">
  </script>
  <noscript>
    &lt;a href="http://s21.sitemeter.com/stats.asp?site=bottlenosewebcounter" target="_top"&gt;&lt;img src="http://s21.sitemeter.com/meter.asp?site=bottlenosewebcounter" alt="Site Meter" border="0"/&gt;&lt;/a&gt;
  </noscript>
</td>
</tr>
</tbody></table><script type="application/javascript" src="./LRU cache implementation in C++_files/analytics.js"></script>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"beacon-4.newrelic.com","queueTime":0,"licenseKey":"a2cef8c3d3","agent":"js-agent.newrelic.com/nr-460.min.js","transactionName":"Z11RZxdWW0cEVkYLDV4XdUYLVEFdClsdAAtEWkZQDlJBGgRFQhFMWFdARwBTG0IMUEURWENdQUUA","userAttributes":"SxpaQDpWQEANUFwWC1NZR1YBFQ9SBFlBB04SUUBsBEdcFl9TUw4RVRQRRhZSR2sLVF8HQAoacl0KWUxZCkBBQB8=","applicationID":"1841284","errorBeacon":"bam.nr-data.net","applicationTime":47}</script>
<iframe scrolling="no" width="0" height="0" src="about:blank" style="display: none !important; visibility: hidden !important; opacity: 0 !important; background-position: 2px 2px;"></iframe><script src="./LRU cache implementation in C++_files/nr-460.min.js"></script><script type="text/javascript" src="./LRU cache implementation in C++_files/a2cef8c3d3"></script></body><iframe frameborder="0" marginheight="0" marginwidth="0" scrolling="no" width="2" height="2" src="./LRU cache implementation in C++_files/log.htm" style="display: none;"></iframe></html>